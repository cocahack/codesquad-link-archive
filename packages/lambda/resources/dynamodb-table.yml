Resources:
  ChannelTable:
    Type: AWS::DynamoDB::Table
    Properties:
      TableName: ${self:custom.channelTableName}
      AttributeDefinitions:
        - AttributeName: channelId
          AttributeType: S
      KeySchema:
        - AttributeName: channelId
          KeyType: HASH
      ProvisionedThroughput:
        ReadCapacityUnits: 5
        WriteCapacityUnits: 5

  UserTable:
    Type: AWS::DynamoDB::Table
    Properties:
      TableName: ${self:custom.userTableName}
      AttributeDefinitions:
        - AttributeName: userId
          AttributeType: S
      KeySchema:
        - AttributeName: userId
          KeyType: HASH
      ProvisionedThroughput:
        ReadCapacityUnits: 5
        WriteCapacityUnits: 5

  LinkTable:
    Type: AWS::DynamoDB::Table
    Properties:
      TableName: ${self:custom.linkTableName}
      AttributeDefinitions:
        - AttributeName: url
          AttributeType: S
        - AttributeName: linkTimestamp
          AttributeType: S
        - AttributeName: userId
          AttributeType: S
        - AttributeName: channelId
          AttributeType: S
      KeySchema:
        - AttributeName: url
          KeyType: HASH
        - AttributeName: linkTimestamp
          KeyType: RANGE

      LocalSecondaryIndexes:
        - IndexName: userIndex
          KeySchema:
            - AttributeName: url
              KeyType: HASH
            - AttributeName: userId
              KeyType: RANGE
          Projection:
            ProjectionType: ALL
        - IndexName: channelIndex
          KeySchema:
            - AttributeName: url
              KeyType: HASH
            - AttributeName: channelId
              KeyType: RANGE
          Projection:
            ProjectionType: ALL

      ProvisionedThroughput:
        ReadCapacityUnits: 5
        WriteCapacityUnits: 5
